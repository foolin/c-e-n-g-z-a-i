@{
    ViewBag.Title = "修改密码";
    var user = Html.GetLoginUser();
}
@section head{
    <link href="@Url.GetResourceUrl("/js/calendar/calendar.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.GetResourceUrl("/js/calendar/jquery.calendar.js")" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#error").hide();
        });

        function beginSubmit() {
            $('.input-validation-error').removeClass('input-validation-error');
            $('.field-validation-error').html('');
            $('#save').button('loading');
            $("#error").hide();
        }
        function succ(err) {
            err = eval(err);
            if (!err) {
                alert("操作异常！");
            }
            if (err.id == "success") {
                alert(err.msg);
                $('#save').button('reset');
                //top.location.href = '@Url.Action("Index","Home")';
                return;
            }
            showErr(err);
        }

        function fail(res) {
            console.log(res);
            $("#errmsg").html(res.responseText);
            $("#error").show();
            $('#save').button('reset');
        }

        function showErr(err) {
            $("#" + err.id).addClass("input-validation-error");
            $("#tips-" + err.id).html(err.msg);
            $("#errmsg").html(err.msg);
            $("#error").show();
            $('#save').button('reset');
        }
    </script>
}



<div class="container bg-white">
<div class="padding">
    <h2>@ViewBag.Title</h2>
    <br />
    @Html.Partial("_SettingNav",new {Active="Password"})
 
    <div class="tab-content">
        <div class="tab-pane active">
            @using (Ajax.BeginForm("Password", null
                , new AjaxOptions { UpdateTargetId = "errmsg", OnBegin = "beginSubmit", OnSuccess = "succ", OnFailure = "fail" }
                , new { @class = "form-horizontal" }))
            {
            <div class="control-group">
                <label class="control-label" for="oldpassword">当前密码：</label>
                <div class="controls">
                    @Html.Password("oldpassword", "", new { @class = "input-middle" })
                    <span class="field-validation-error" data-valmsg-for="oldpassword" id="tips-oldpassword" data-valmsg-replace="true"></span>
                    <p class="help-block">请输入当前密码，请输入新密码</p>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="password">新密码：</label>
                <div class="controls">
                    @Html.Password("password", "", new { @class = "input-middle" })
                    <span class="field-validation-error" data-valmsg-for="password" id="tips-password" data-valmsg-replace="true"></span>
                    <p class="help-block">请输入新密码</p>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="repassword">重复新密码：</label>
                <div class="controls">
                    @Html.Password("repassword", "", new { @class = "input-middle" })
                    <span class="field-validation-error" data-valmsg-for="repassword" id="tips-repassword" data-valmsg-replace="true"></span>
                    <p class="help-block">请重复输入新密码</p>
                </div>
            </div>
            <div class="form-actions"> 
                <button type="submit" id="save" class="btn btn-primary" data-loading-text="正在保存..." onclick="return confirm('请确定修改密码？');">保存</button>
            </div>
            <div class="alert alert-block alert-error" id="error">
                <a class="close" href="#" onclick="$('#error').hide(); return false;">&times;</a>
                <h4 class="alert-heading">唉哟，出错了！</h4>
                <p id="errmsg"></p>
            </div>
            }
        </div>
    </div>

</div>
</div>   
<!--/.container -->
